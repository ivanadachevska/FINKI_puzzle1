# Документација за апликацијата Финки сложувалка

## Објаснување на проблемот


Апликацијата која ја развивавме е резултат на заедничка работа на нашиот тим составен од: Ивана Дачевска (231077), Ивана Апостолова (231076) и Вероника Иванова (231073).

За нашиот проект, имплементиравме едноставна логичка игра од типот Picture Puzzle, користејќи Windows Forms и C#. Нашата игра нуди забава и буди логичко размислување преку составување на измешани парчиња слика во нивната оригинална форма.
Целта на апликацијата е корисникот да ја реши слагалката, т.е да ја состави оригиналната слика која е исечена на повеќе парчиња (3х3) кои се случајно измешани. Решавањето се врши преку интерактивно преместување на деловите (парчињата) во мрежа, сè додека не се врати првичниот изглед на сликата.

Некои главни функционалности на нашата игра се:

 1. Автоматско сечење на слика на квадратни делови.


 2. Случајно мешање на парчињата пред почетокот на играта.


 3. Интерактивно поместување на парчињата преку кликнување на парчето слика кое играчот сака да го помести.


 4. Броење на потези (поместувања): секојпат кога играчот ќе помести парче, се зголемува бројачот на потези.


 5. Тајмер: од моментот на започнување на играта започнува и броење на времето потребно за решавање, кое е ограничено.


 6. Детекција на успешно решение: кога сите парчиња ќе се најдат на соодветна позиција, играта го информира играчот дека ја завршил слагалката.


 7. Прикажување на оригиналната слика, како помош доколку играчот не се снаоѓа.


 8. Ресетирање на играта или ново мешање на парчињата.


Инспирацијата за нашата апликација доаѓа од популарните sliding puzzle games, кои се користат како мобилни и десктоп апликации за забава и вежбање на мозокот. Некои познати примери се: Microsoft Jigsaw и       Jigsaw Puzzle - MobilityWare.


За поставување на основната структура на апликацијата и визуелниот распоред на формата односно дизајнот, се водевме според [видео туторијал](https://youtu.be/cVe7sGmkBLo) кој е достапен на Youtube.

## Решение на проблемот

### Податоци кои се чуваат

Во апликацијата се чуваат различни видови на податоци кои се клучни за правилно функционирање на играта. Податоците се организирани во променливи, листи и тајмери кои се активно следени и ажурирани во текот на играта. Секој коментар детално објаснува која е улогата на секоја променлива и нејзината функција во играта.

```csharp
public partial class frmPuzzleGame : Form
{
    int delpoz = 0;
    // opis: indeks na prazno parche na slozhuvalkata
    // funkcija: se kontroliraat koi parchinja se dozvoleni za dvizhenje

    int vodvizenje = 0;
    // opis: se chuva vkupniot broj na potezi shto gi napravil korisnikot od pochetok na igrata
    // funkcija: ja pokazhuva uspeshnosta na igrachot

    List<Bitmap> orginalLista = new List<Bitmap>();
    // opis: listata gi chuva site sliki i parcheto za prazno pole
    // funkcija: konfiguracija za pravilen redosled na parchinjata i proverka dali igrata e zavrshena uspeshno

    System.Diagnostics.Stopwatch timer = new System.Diagnostics.Stopwatch();
    // opis: meri vreme pominato od pochetok na igrata
    // funkcija: korisnikot ima ogranicheno vreme od edna minuta za reshavnaje na slozhuvalkata
}
```
### Структури во кои се чуваат податоците

1. Целобројни променливи
   
   Се користат за следење на позиција на празното парче (delpoz) и број на потези (vodvizenje). Тие се едноставни типови на податоци кои се ажурираат динамично со секој потег на играчот.
   
2. Листа од слики – List<Bitmap>

Листата orginalLista претставува динамична структура која содржи редослед на слики, не се менува, туку служи како модел за споредба дали тековниот распоред на парчињата е точен.

3. Група на графички контроли – GroupBox со PictureBox контроли

Во групата gbSlozuvalkaBox се сместени девет PictureBox контроли. Секоја PictureBox визуелно претставува едно парче од сложувалката.

4. Тајмер – System.Diagnostics.Stopwatch

Оваа структура е посебен објект што овозможува мерење на реално време. Тајмерот може да се стартува, паузира и ресетира според потребите на играта. Toj е поврзан со временско ограничување, односно ако помине една минута, играта автоматски се ресетира.

### Класи

Во овој проект, целата логика и податоци се организирани во една главна класа frmPuzzleGame.

```csharp
 public frmPuzzleGame()
```
Основна класа која ги содржи сите податоци и методи потребни за функционирањето на играта.

Функции на класата:

1. Чување на состојбата на играта (позиција на празно парче, број на потези)
   
2. Чување на оригиналната конфигурација на парчињата
   
3. Управување со графичкиот приказ преку PictureBox контроли
   
4. Управување со тајмерот за следење на времето
   
5. Ракување со сите кориснички настани, како што се:
   
-Клик на парче

-Промешување на парчињата

-Пауза/Продолжи

-Излез од играта

-Автоматски предлог за следен потег

## Опис на функции

### 1. Функција Promesaj()

```csharp
       void Promesaj()
       {
           do
           {
               int j;
               List<int> pozicii = new List<int>(new int[] { 0, 1, 2, 3, 4, 5, 6, 7, 9 });
               Random r = new Random();
               for (int i = 0; i < 9; i++)
               {
                   pozicii.Remove((j = pozicii[r.Next(0, pozicii.Count)]));
                   ((PictureBox)gbSlozuvalkaBox.Controls[i]).Image = orginalLista[j];
                   if (j == 9) { delpoz = i; }
               }
           } while (Pobeda());
       }
```
Функцијата Promesaj() има клучна улога во функционирањето на играта на сложувалка. Нејзината основна цел е иницијализација и случајно мешање на парчињата во сложувалката, секогаш кога ќе започне нова игра или кога корисникот ќе побара да се промеша сложувалката.

Главниот фокус на функцијата е парчињата да бидат поставени во случаен редослед, но при тоа да се внимава сложувалката да не биде веднаш решена на старт.
При извршувањето, функцијата прво создава листа со индекси – pozicii, која ги содржи сите можни позиции на парчињата, освен индексот 8. Во листата се наоѓаат следните вредности: {0, 1, 2, 3, 4, 5, 6, 7, 9}, каде бројот 9 е резервиран за празното парче.

Потоа, со користење на објектот Random, функцијата избира случајни индекси од листата, при што секој веќе избран индекс веднаш се отстранува од листата за да се спречи повторување. Избраната слика од оригиналната листа orginalLista[j] се поставува во соодветниот PictureBox во групата gbSlozuvalkaBox. Доколку во тој момент е избрано празното парче (со индекс 9), неговата позиција се чува во променливата delpoz.

За да се гарантира дека сложувалката не е веќе решена, процесот на мешање се повторува се додека не се добие нерешена конфигурација. Ова се проверува со функцијата Pobeda(), која враќа true ако парчињата се наредени правилно.

### Вклучување на генеративна вештачка интелигенција (AI)

При реализација и оптимизација на функцијата Promesaj(), беше користена генеративна вештачка интелигенција – ChatGPT (GPT-4). 

Оваа AI поддршка беше употребена за дефинирање на логиката за случајно мешање на парчињата и за добивање на препораки за најдобри практики при изведба на ваков тип на алгоритам.


Користен AI модел:

- Модел: GPT-4 (ChatGPT)
  
- Развиен од: OpenAI

Цел на користењето:

Да се добие пример на алгоритам за случајно мешање на парчиња во сложувалка.

Да се осигура дека решението не е веднаш дадено на почеток.

Да се добие насока за правилно управување со листи на индекси и исклучување на веќе избраните елементи.

- Користени prompts:
  
Во комуникацијата со AI моделот, беа поставени следниве конкретни барања:

1. Prompt 1: „Како да направам функција во C# која ќе меша парчиња од сложувалка на случаен начин, без да се добие решена сложувалка на почеток?“
   
2. Prompt 2: „Може пример за алгоритам што избира парчиња на случаен начин од листа, без да се повторуваат истите индекси?“
   
3. Prompt 3: „Како да проверам дали тековниот распоред на парчињата е решен и како да ги промешам пак ако е така?“
   
- Добивка од користењето на AI:

  Добиен е совет за користење на do-while циклус со вклучена проверка преку Pobeda() за да се избегне сценарио каде сложувалката е веќе решена на старт.

### 2. Функција pbSmeni()

```csharp
private void pbSmeni(object sender, EventArgs e)
{
    if (lblVreme.Text == "00:00:00")
        timer.Start();
    int voSlika = gbSlozuvalkaBox.Controls.IndexOf(sender as Control);
    if (delpoz != voSlika)
    {
        List<int> fb = new List<int>();

        if (voSlika % 3 == 0)

            fb.Add(-1);
        else
            fb.Add(voSlika - 1);

        fb.Add(voSlika - 3);

        if (voSlika % 3 == 2)
            fb.Add(-1);
        else
            fb.Add(voSlika + 1);

        fb.Add(voSlika + 3);
        if (fb.Contains(delpoz))
        {
            ((PictureBox)gbSlozuvalkaBox.Controls[delpoz]).Image = ((PictureBox)gbSlozuvalkaBox.Controls[voSlika]).Image;
            ((PictureBox)gbSlozuvalkaBox.Controls[voSlika]).Image = orginalLista[9];
            delpoz = voSlika;
            lblBrPotezi.Text = "Број на потези : " + (++vodvizenje);
            if (Pobeda())
            {
                timer.Stop();
                (gbSlozuvalkaBox.Controls[8] as PictureBox).Image = orginalLista[8];
                MessageBox.Show("Честитки...\nИзминато време:" + timer.Elapsed.ToString().Remove(8) + "\nВкупен број на потези : " + vodvizenje, "ФИНКИ сложувалка");
                vodvizenje = 0;
                lblBrPotezi.Text = "Број на потези : 0";
                lblVreme.Text = "00:00:00";
                timer.Reset();
                Promesaj();
            }
        }
    }
}
```
Функцијата pbSmeni() е една од најзначајните компоненти во апликацијата и има клучна улога во реализација на потезите во играта на сложувалка. Оваа функција е задолжена за обработка на корисничкиот настан кога се кликнува на некое парче од сложувалката. Со нејзиното извршување се овозможува проверка дали кликнатото парче може да се помести и, доколку е дозволено, се изведува размена на парчињата.

На почетокот на функцијата, доколку е направен првиот потег и тајмерот сè уште не е активен, тој автоматски се стартува за да започне мерење на времето потребно за решавање на сложувалката. Веднаш потоа, функцијата ја детектира точната позиција (индекс) на парчето што го кликнал корисникот. Идентификацијата се прави преку пронаоѓање на индексот на PictureBox контролата која е кликната, односно преку одредување на позицијата на кликнатото парче во групата на сите парчиња.

Следниот чекор е валидација на потегот. Според правилата на играта, корисникот може да помести парче само ако тоа е веднаш до празното поле, во една од четирите дозволени насоки (горе, долу, лево или десно). Функцијата ја пресметува листата на сите валидни соседни позиции на кликнатото парче и проверува дали празното поле се наоѓа на некоја од тие позиции. Со ова се обезбедува придржување до правилата на играта и се спречува изведување на недозволени потези.

Доколку потегот е валиден, функцијата извршува размена на сликите помеѓу кликнатото парче и празното поле, а потоа ја ажурира позицијата на празното парче. Бројот на потези кои ги направил корисникот се зголемува за еден и новата вредност веднаш се прикажува на екранот за визуелна потврда на напредокот.
По секој извршен потег, функцијата врши проверка дали сложувалката е успешно решена со повик на функцијата Pobeda(). Доколку сите парчиња се наместени во правилен редослед, играта се смета за завршена, тајмерот се стопира, се прикажува порака со вкупното време и бројот на направени потези, а играта се ресетира и се подготвува за нов почеток.


## Kратко упатство како се користи/игра


Со иницијалното вклучивање на играта, изгледот на почетниот екран изгледа вака:


![inicijalno](https://github.com/user-attachments/assets/71a0c655-c124-45ad-b954-6dd739f35c7e)

За да започне тајмерот на играта односно да почне самата игра, мора да се направи барем едно поместување на дел од измешаната слика, делот мора да се наоѓа околу црниот (слободен) дел од измешаните парчиња, со кликање на посакуваниот дел, тој се поместува и почнува одбројувањето на чекорите. Пример со поместување делот кој се наоѓа во тpeтиот ред, трета колона:


![poteg1](https://github.com/user-attachments/assets/6ba205c7-bd20-4497-a8e7-3826869842ad)
![poteg2](https://github.com/user-attachments/assets/fee9e223-da1d-411c-9640-f478c8157764)


Со кликање на копчето “Помош” од menuStrip-от на формата на екранот се појавува детално упатство кое му помага на играчот доколку не знае како да ја игра играта. 

![pomos](https://github.com/user-attachments/assets/64fcbd10-2519-460f-9bb1-9c1b57b35cae)

Со кликање на копчето “Комплетирај” од menuStrip-от на формата, измешаните делови од сликата се поместуваат во правилниот редослед при што се комплетира сликата и се ресетираат бројот на чекори и тајмерот на 0. Со кликање на “ОК” копчето, играчот може да продолжи со играње на играта доколку кликне на копчето “Промешај” или пак да заврши со играње и да кликне на копчето “Излези”.


![kompletiraj](https://github.com/user-attachments/assets/6e88166f-7feb-45de-a25e-1fac3075780d)


Со кликање на копчето “Следен потег” од menuStrip-от на формата,  овозможува автоматски да се направи најдобриот можен потег од тековната позиција на празното поле во играта, доколку на играчот му е потребна помош.


![sledenpoteg](https://github.com/user-attachments/assets/0cf79c7b-7fbd-4167-b2f4-c680438b967d)


Со кликање на копчето “Промешај” и потоа на копчето “Yes” се меша редоследот на измешаните парчиња одново, се ресетира бројот на потези и тајмерот на 0.


![promesaj1](https://github.com/user-attachments/assets/833872fd-dfc1-478f-867e-c93ab79bc8fc)
![promesaj2](https://github.com/user-attachments/assets/6a8a6692-6532-41fe-a5df-7c159b100aa5)


Со кликање на копчето “Пауза” тајмерот се паузира и измешаната слика повеќе не се прикажува на екранот, текстот на копчето се менува во “Продолжи”. За да продолжиме со играта кликаме на истото копче, тајмерот продолжува каде што застанал и измешаните парчиња се појавуваат пак на екранот. 



![pauza1](https://github.com/user-attachments/assets/cb6852c0-7129-4e9f-8a1a-7254d75a9022)
![pauza2](https://github.com/user-attachments/assets/991a8a2a-7be2-473e-9eb4-82de10cbece5)


Со клик на копчето “Излези” па потоа, “Yes” се излегува од играта и се затвора апликацијата.


![izlez](https://github.com/user-attachments/assets/26f09eab-7f89-4fc8-8672-3369b5009705)


Доколку играчот не успее да ја реши слагалката во рок од 1мин. се појавува следниот прозорец, после кликање на копчето “ОК” играчот може повторно да проба да ја игра играта.


![tajmeer](https://github.com/user-attachments/assets/15370892-84fd-48e6-8e0e-128b4ae9bdfd)
